<!-- templates/admin/knowledge_edit.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .container { max-width: 1200px; }
        .question-card {
            margin-bottom: 12px;
            padding: 16px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            background: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .answer-preview {
            white-space: pre-wrap;
            font-size: 0.95em;
            color: #333;
            line-height: 1.5;
            margin: 8px 0;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .btn-sm { font-size: 0.85em; padding: 0.25rem 0.5rem; }
        .search-box { max-width: 400px; margin-bottom: 20px; }
        .flash-success { background: #d4edda; border-left: 4px solid #28a745; }
        .flash-error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .flash-container { margin-bottom: 20px; padding: 12px; border-radius: 4px; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="mb-4">üõ† –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</h2>
    <p><a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É</a></p>

    <!-- Flash-—Å–æ–æ–±—â–µ–Ω–∏—è -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-container flash-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-box">
        <input type="text" id="searchInput" class="form-control" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º...">
    </div>

    <!-- –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å</h5>
            <form method="POST">
                <input type="hidden" name="action" value="add">
                <div class="mb-3">
                    <label>–í–æ–ø—Ä–æ—Å (–∫–ª—é—á):</label>
                    <input type="text" name="question" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>–û—Ç–≤–µ—Ç (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è \n, ‚Ä¢, —ç–º–æ–¥–∑–∏, [—Å—Å—ã–ª–∫–∞](/url)):</label>
                    <textarea name="answer" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..."></textarea>
                </div>
                <button type="submit" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ -->
    <h4>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã ({{ knowledge|length }})</h4>
    <div id="questionsContainer" class="row">
        {% for q, a in knowledge.items() %}
        <div class="col-md-6 question-item">
            <div class="question-card" data-question="{{ q }}">
                <strong>{{ q }}</strong>
                <div class="answer-preview">{{ a }}</div>

                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                <div class="mt-2">
                    <button class="btn btn-warning btn-sm" onclick="editQuestion('{{ q }}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <form method="POST" style="display:inline;">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="question" value="{{ q }}">
                        <button type="submit" class="btn btn-danger btn-sm" 
                                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å \"{{ q }}\"?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </div>

                <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–∫—Ä—ã—Ç–∞) -->
                <form method="POST" id="edit-form-{{ q }}" style="display:none; margin-top:10px;">
                    <input type="hidden" name="action" value="edit">
                    <input type="hidden" name="question" value="{{ q }}">
                    <textarea name="answer" class="form-control">{{ a }}</textarea>
                    <div class="mt-2">
                        <button type="submit" class="btn btn-success btn-sm">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="button" class="btn btn-secondary btn-sm" 
                                onclick="cancelEdit('{{ q }}')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if knowledge|length == 0 %}
    <p class="text-muted">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å.</p>
    {% endif %}
</div>

<script>
// –ü–æ–∏—Å–∫ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
document.getElementById('searchInput').addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase();
    document.querySelectorAll('.question-item').forEach(item => {
        const question = item.querySelector('[data-question]').dataset.question.toLowerCase();
        item.style.display = question.includes(query) ? 'block' : 'none';
    });
});

// –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function editQuestion(question) {
    document.getElementById(`edit-form-${question}`).style.display = 'block';
}

// –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function cancelEdit(question) {
    document.getElementById(`edit-form-${question}`).style.display = 'none';
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<input type="text" id="search" class="form-control mb-3" placeholder="–ü–æ–∏—Å–∫ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º...">
<script>
document.getElementById('search').addEventListener('input', function() {
    const query = this.value.toLowerCase();
    document.querySelectorAll('.card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(query) ? 'block' : 'none';
    });
});
</script>