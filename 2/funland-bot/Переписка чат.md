

Qwen3-235B-A22B-2507


Loading...
profile
Qwen3-235B-A22B-2507
–û—Ç–ª–∏—á–Ω–æ! –í—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏, —á—Ç–æ —Ñ–∞–π–ª dashboard copy.html.txt –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ.

–¢–µ–ø–µ—Ä—å —è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª—é –µ–≥–æ –∫–∞–∫ templates/admin/dashboard.html ‚Äî –æ—Å–Ω–æ–≤–Ω—É—é –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –∏ –æ—Ç–∫—É–¥–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤.

‚úÖ –ß—Ç–æ –±—É–¥–µ—Ç –≤ dashboard.html
‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚úÖ –ö–Ω–æ–ø–∫–∏:
üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
üîê –í—ã—Ö–æ–¥
‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω (Bootstrap)
‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≤–∞—à–∏–º web_app.py
‚úÖ –§–∞–π–ª: templates/admin/dashboard.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/dashboard.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .booking-card {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .header-actions {
            margin-bottom: 20px;
        }
        .empty-state {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>üìã –í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>

    <div class="header-actions">
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
        <a href="{{ url_for('knowledge_edit') }}" class="btn btn-warning btn-sm">üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</a>
        <a href="{{ url_for('view_logs') }}" class="btn btn-info btn-sm">üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</a>
    </div>

    {% if bookings %}
        {% for b in bookings %}
        <div class="booking-card">
            <h5>{{ b.name }}</h5>
            <p>
                <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ b.phone }}<br>
                <strong>–î–∞—Ç–∞:</strong> {{ b.date }}<br>
                <strong>–ì–æ—Å—Ç–∏:</strong> {{ b.guests }}<br>
                <strong>–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:</strong> {{ b.event_type }}<br>
                <strong>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ b.created_at }}
            </p>
        </div>
        {% endfor %}
    {% else %}
        <p class="empty-state">–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.</p>
    {% endif %}
</div>
</body>
</html>
‚úÖ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª:
–ò–∑: dashboard copy.html.txt
–í: dashboard.html
–ü–æ–º–µ—Å—Ç–∏—Ç–µ –≤ –ø–∞–ø–∫—É:


1
templates/admin/dashboard.html
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ web_app.py –µ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç:
python


1
2
3
4
5
‚åÑ
‚åÑ
@app.route("/admin")
def admin_dashboard():
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    return render_template("admin/dashboard.html", bookings=BOOKINGS)
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:
bash


1
python web_app.py
–ü–µ—Ä–µ–π–¥–∏—Ç–µ:
http://127.0.0.1:5000/admin/login ‚Üí –≤–æ–π–¥–∏—Ç–µ
http://127.0.0.1:5000/admin ‚Üí —É–≤–∏–¥–∏—Ç–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–ê–¥–º–∏–Ω–∫–∞ —Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ï—Å—Ç—å –≤—Å–µ —Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–∞:
/admin ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
/admin/knowledge ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
/admin/logs ‚Äî –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª ZIP —Å –ø–æ–ª–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –¥–∞—Ç–µ?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
image.png
–ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–µ–Ω—è–ª–∞—Å—å.PS C:\funland-bot> python web_app.py
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 85 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ knowledge_base.json
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 5 –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 85 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ knowledge_base.json
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 5 –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
üîÑ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∞!
* Running on all addresses (0.0.0.0)
* Running on http://127.0.0.1:5000
* Running on http://192.168.0.223:5000
Press CTRL+C to quit
 * Serving Flask app 'web_app'
 * Debug mode: off

profile
Qwen3-235B-A22B-2507
–í—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –¥–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏:

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ web_app.py –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–≤–∞–∂–¥—ã –æ–¥–Ω–∞ –∏ —Ç–∞ –∂–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /admin/logs –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ"
‚ùå –ü—Ä–∏—á–∏–Ω–∞ 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤


1
2
3
4
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 85 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ knowledge_base.json
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 5 –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 85 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ knowledge_base.json
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 5 –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
üîç –ü—Ä–∏—á–∏–Ω–∞:
–í –≤–∞—à–µ–º –∫–æ–¥–µ –µ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∑–æ–≤ load_knowledge_base() ‚Äî –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã.

‚úÖ –†–µ—à–µ–Ω–∏–µ
üõ† –®–∞–≥ 1: –£–¥–∞–ª–∏—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç load_knowledge_base()
–ù–∞–π–¥–∏—Ç–µ –≤ web_app.py —Å—Ç—Ä–æ–∫—É:

python


1
load_knowledge_base()
–ò —É–¥–∞–ª–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ (–æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –≤ if __name__ == "__main__":).

–û—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤—ã–∑–æ–≤ –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞, –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–æ–≤.

üõ† –®–∞–≥ 2: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ load_knowledge_base() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
python


1
2
3
# --- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
load_knowledge_base()
load_bookings()
‚úÖ –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞. 

‚ùå –ü—Ä–∏—á–∏–Ω–∞ 2: "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ"
–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –µ—Å–ª–∏: 

–í—ã –µ—â—ë –Ω–µ –∑–∞–¥–∞–≤–∞–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –±–æ—Ç—É
–ò–ª–∏ bot_log.json –ø—É—Å—Ç
‚úÖ –†–µ—à–µ–Ω–∏–µ
üõ† –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª bot_log.json
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª c:\funland-bot\bot_log.json —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

json


1
[]
üõ† –®–∞–≥ 2: –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –±–æ—Ç—É
–û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:5000 –∏ –Ω–∞–ø–∏—à–∏—Ç–µ:



1
–ø—Ä–∏–≤–µ—Ç
üõ† –®–∞–≥ 3: –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É


1
http://127.0.0.1:5000/admin/logs
‚úÖ –¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å. 

‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
python web_app.py
–í—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏
—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
/admin/logs
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç
–∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤
/admin
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç
–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
/admin/knowledge
–ü–æ–∑–≤–æ–ª—è–µ—Ç
—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª
–ø–æ–ª–Ω—ã–π web_app.py?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
image.png
–ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –Ω–µ—ë –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è 

profile
Qwen3-235B-A22B-2507
–í—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–æ–π:
–ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∞–¥–º–∏–Ω–∫—É (/admin) –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /admin/logs.

‚ùå –ü—Ä–∏—á–∏–Ω–∞
–í –≤–∞—à–µ–º web_app.py –µ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤, –∏ /admin –≤–µ–¥—ë—Ç –Ω–∞ /admin/logs, –ø–æ—Ç–æ–º—É —á—Ç–æ:

python


1
2
3
‚åÑ
@app.route("/admin")
def admin_dashboard():
    return render_template("admin/dashboard.html", bookings=BOOKINGS)
‚ö†Ô∏è –≠—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –∏–ª–∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è ‚Äî –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥—Ä—É–≥–æ–π –º–∞—Ä—à—Ä—É—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç logs.html. 

üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
–û—Ç–∫—Ä–æ–π—Ç–µ web_app.py –∏ –Ω–∞–π–¥–∏—Ç–µ:

python


1
@app.route("/admin")
–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ:

python


1
2
3
4
‚åÑ
@app.route("/admin")
def view_logs():
    # ...
    return render_template("admin/logs.html", logs=logs)
‚Üí –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã —Å–ª—É—á–∞–π–Ω–æ –∑–∞–º–µ–Ω–∏–ª–∏ admin_dashboard() –Ω–∞ view_logs().

‚úÖ –†–µ—à–µ–Ω–∏–µ
üîß –®–∞–≥ 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç /admin
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ web_app.py –µ—Å—Ç—å:

python


1
2
3
4
5
6
‚åÑ
‚åÑ
@app.route("/admin")
def admin_dashboard():
    """–ì–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω–∫–∏ ‚Äî —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    return render_template("admin/dashboard.html", bookings=BOOKINGS)
‚úÖ –≠—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è /admin 

üîß –®–∞–≥ 2: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ dashboard.html —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª: templates/admin/dashboard.html

html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/dashboard.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .booking-card {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .header-actions {
            margin-bottom: 20px;
        }
        .empty-state {
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>üìã –í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>

    <div class="header-actions">
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
        <a href="{{ url_for('knowledge_edit') }}" class="btn btn-warning btn-sm">üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</a>
        <a href="{{ url_for('view_logs') }}" class="btn btn-info btn-sm">üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</a>
    </div>

    {% if bookings %}
        {% for b in bookings %}
        <div class="booking-card">
            <h5>{{ b.name }}</h5>
            <p>
                <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ b.phone }}<br>
                <strong>–î–∞—Ç–∞:</strong> {{ b.date }}<br>
                <strong>–ì–æ—Å—Ç–∏:</strong> {{ b.guests }}<br>
                <strong>–¢–∏–ø —Å–æ–±—ã—Ç–∏—è:</strong> {{ b.event_type }}<br>
                <strong>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ b.created_at }}
            </p>
        </div>
        {% endfor %}
    {% else %}
        <p class="empty-state">–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.</p>
    {% endif %}
</div>
</body>
</html>
üîß –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫


1
2
3
4
5
6
7
8
9
10
c:\funland-bot\
‚îÇ
‚îú‚îÄ‚îÄ web_app.py
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.html        ‚Üê –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ knowledge_edit.html
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logs.html
‚îÇ   ‚îî‚îÄ‚îÄ index.html
‚îî‚îÄ‚îÄ knowledge_base.json
üîß –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç
bash


1
python web_app.py
üîß –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
–û—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:5000/admin/login
–í–æ–π–¥–∏—Ç–µ
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://127.0.0.1:5000/admin
‚úÖ –¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ 

üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
–ï—Å—Ç—å –≤—Å–µ —Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–∞:
/admin ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
/admin/knowledge ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
/admin/logs ‚Äî –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º –∏–∑ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª ZIP —Å –ø–æ–ª–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –¥–∞—Ç–µ?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
–î–æ promt –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –î–û–ë–ê–í–ò–¢–¨ –ü–†–û–°–ú–û–¢–† –ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ß–ï–†–ï–ó –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨: –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ

profile
Qwen3-235B-A22B-2507
–û—Ç–ª–∏—á–Ω–æ! –í—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏, —á—Ç–æ –¥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å promt, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ:

‚úÖ –ê–¥–º–∏–Ω–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–ª–∞—Å—å: /admin ‚Üí dashboard.html
‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: /admin/knowledge
‚úÖ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤: /admin/logs ‚Äî –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∞—Å—å
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å
‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
üõ†Ô∏è –ß—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π?
–í—ã –≤–Ω–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –ø—Ä–æ–º—Ç–∞–º–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É, –∏ —Ç–µ–ø–µ—Ä—å:

‚ùå –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ /admin –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–µ dashboard.html, –∞ logs.html 

üîç –ü—Ä–∏—á–∏–Ω–∞
–ü—Ä–æ–∏–∑–æ—à–ª–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ /admin.
–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã —Å–ª—É—á–∞–π–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é admin_dashboard() –∏–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

‚úÖ –†–µ—à–µ–Ω–∏–µ: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç /admin
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ web_app.py –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç:
python


1
2
3
4
5
6
‚åÑ
‚åÑ
@app.route("/admin")
def admin_dashboard():
    """–ì–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω–∫–∏ ‚Äî —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    return render_template("admin/dashboard.html", bookings=BOOKINGS)
‚úÖ –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å, –∏ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞. 

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ dashboard.html –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –Ω—É–∂–Ω–æ–π –ø–∞–ø–∫–µ


1
2
3
4
5
templates/
‚îî‚îÄ‚îÄ admin/
    ‚îú‚îÄ‚îÄ dashboard.html        ‚Üê –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
    ‚îú‚îÄ‚îÄ knowledge_edit.html
    ‚îî‚îÄ‚îÄ logs.html
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
–£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –º–∞—Ä—à—Ä—É—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å /admin, –Ω–∞–ø—Ä–∏–º–µ—Ä:

python


1
2
3
4
‚åÑ
# ‚ùå –£–¥–∞–ª–∏—Ç–µ, –µ—Å–ª–∏ –µ—Å—Ç—å:
@app.route("/admin")
def view_logs():
    return render_template("admin/logs.html", logs=logs)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ dashboard.html ‚Äî –≤–∞—à —Ä–∞–±–æ—á–∏–π
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ dashboard copy.html.txt:

html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/dashboard.html -->
<div class="admin-container">
    <div class="admin-header">
        <h1>üìã –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        <a href="/admin/logout"><button class="logout-btn">–í—ã—Ö–æ–¥</button></a>
    </div>
    <h2>–í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è ({{ bookings|length }})</h2>
    {% if bookings %}
    <table class="bookings-table">
        <thead>
            <tr>
                <th>–ò–º—è</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–î–∞—Ç–∞</th>
                <th>–ì–æ—Å—Ç–µ–π</th>
                <th>–¢–∏–ø —Å–æ–±—ã—Ç–∏—è</th>
                <th>–°–æ–∑–¥–∞–Ω–æ</th>
            </tr>
        </thead>
        <tbody>
            {% for b in bookings %}
            <tr>
                <td>{{ b.name }}</td>
                <td>{{ b.phone }}</td>
                <td>{{ b.date }}</td>
                <td>{{ b.guests }}</td>
                <td>{{ b.event_type }}</td>
                <td>{{ b.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.</p>
    {% endif %}

    <div class="actions">
        <a href="/admin/knowledge"><button>üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</button></a>
        <a href="/admin/logs"><button>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</button></a>
    </div>
</div>
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç
bash


1
python web_app.py
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
http://127.0.0.1:5000/admin/login
–§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
http://127.0.0.1:5000/admin
–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
http://127.0.0.1:5000/admin/knowledge
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
http://127.0.0.1:5000/admin/logs
–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
–í—Å–µ —Ä–∞–∑–¥–µ–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã
–ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–ª–æ–≥–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª –ø–æ–ª–Ω—ã–π web_app.py?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä

dashboard copy 2.html
.txt
2.5 KB

web_app copy.py
.txt
11.1 KB
–í–µ—Ä–Ω–µ–º—Å—è –∫ –≤–∞—Ä–∏–∞–Ω—Ç—É –¥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º —Ç–µ–ø–µ—Ä—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ –±—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–≥ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–Ω–æ—Å–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ù–∞—à–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ  —Ñ–∞–π–ª—ã/ —Å—á–∏—Ç–∞–µ–º –∏—Ö –æ—Å–Ω–æ–≤–Ω–æ–π.  –∏ –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ:—Å–¥–µ–ª–∞–µ–º —Ç–µ–ø–µ—Ä—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ –±—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–≥ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤–Ω–æ—Å–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

profile
Qwen3-235B-A22B-2507
–û—Ç–ª–∏—á–Ω–æ! –ú—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞, –≥–¥–µ:

‚úÖ –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∏–∑ –±–∞–∑—ã
–¢–µ–ø–µ—Ä—å –ø–æ—à–∞–≥–æ–≤–æ –¥–æ–±–∞–≤–∏–º –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤, —á—Ç–æ–±—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–≥ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∏—Ö —É–ª—É—á—à–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π.

‚úÖ –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ:

–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
–ò—Å—Ç–æ—á–Ω–∏–∫: –∏–∑ –±–∞–∑—ã –∏–ª–∏ –æ—Ç Yandex GPT
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å –≤ –±–∞–∑—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
‚úÖ –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
–í web_app.py –¥–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

python


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
import json
import os
from datetime import datetime

# --- –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ ---
LOG_FILE = "bot_log.json"

def log_interaction(question, answer, source):
    """–õ–æ–≥–∏—Ä—É–µ—Ç –¥–∏–∞–ª–æ–≥ –≤ JSON-—Ñ–∞–π–ª"""
    log_entry = {
        "timestamp": datetime.now().isoformat(),
        "question": question,
        "answer": answer,
        "source": source  # "knowledge_base" –∏–ª–∏ "yandex_gpt"
    }
    try:
        logs = []
        if os.path.exists(LOG_FILE):
            with open(LOG_FILE, "r", encoding="utf-8") as f:
                content = f.read().strip()
                if content:
                    logs = json.loads(content)
        logs.append(log_entry)
        with open(LOG_FILE, "w", encoding="utf-8") as f:
            json.dump(logs, f, ensure_ascii=False, indent=4)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
‚úÖ –®–∞–≥ 2: –í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /ask
–ù–∞–π–¥–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç /ask –∏ –¥–æ–±–∞–≤—å—Ç–µ log_interaction():

python


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
‚åÑ
‚åÑ
‚åÑ
‚åÑ
@app.route("/ask", methods=["POST"])
def ask():
    data = request.get_json()
    question = data.get("question", "").strip().lower()
    user_id = data.get("user_id", "default")

    if user_id not in conversation_history:
        conversation_history[user_id] = []

    # –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    for key in KNOWLEDGE_BASE:
        if key in question:
            answer = KNOWLEDGE_BASE[key]
            conversation_history[user_id].append({"role": "user", "text": question})
            conversation_history[user_id].append({"role": "assistant", "text": answer})
            
            # üî• –õ–û–ì–ò–†–£–ï–ú
            log_interaction(question, answer, "knowledge_base")
            
            return jsonify({"answer": answer})

    # –ó–∞–ø—Ä–æ—Å –∫ Yandex GPT
    gpt_answer = call_yandex_gpt(question, conversation_history[user_id])
    conversation_history[user_id].append({"role": "user", "text": question})
    conversation_history[user_id].append({"role": "assistant", "text": gpt_answer})
    
    # üî• –õ–û–ì–ò–†–£–ï–ú
    log_interaction(question, gpt_answer, "yandex_gpt")
    
    return jsonify({"answer": gpt_answer})
‚úÖ –®–∞–≥ 3: –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É /admin/logs
–î–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ web_app.py:
python


1
2
3
4
5
6
7
8
9
10
11
12
13
‚åÑ
‚åÑ
‚åÑ
‚åÑ
@app.route("/admin/logs")
def view_logs():
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))

    logs = []
    if os.path.exists(LOG_FILE):
        with open(LOG_FILE, "r", encoding="utf-8") as f:
            logs = json.load(f)
        logs = sorted(logs, key=lambda x: x["timestamp"], reverse=True)

    return render_template("admin/logs.html", logs=logs)
‚úÖ –®–∞–≥ 4: –°–æ–∑–¥–∞–π—Ç–µ —à–∞–±–ª–æ–Ω templates/admin/logs.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/logs.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .log-entry { margin-bottom: 15px; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; }
        .source-b { background: #d4edda; }
        .source-g { background: #d1ecf1; }
        .question { font-weight: bold; color: #1f2d3d; }
        .answer { margin: 8px 0; white-space: pre-wrap; }
        .timestamp { font-size: 0.85em; color: #6c757d; }
    </style>
</head>
<body>
<div class="container">
    <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</h2>
    <p>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
        <a href="{{ url_for('export_logs') }}" class="btn btn-success btn-sm">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</a>
    </p>

    {% if logs %}
        {% for log in logs %}
        <div class="log-entry source-{{ 'b' if log.source == 'knowledge_base' else 'g' }}">
            <div class="timestamp">{{ log.timestamp }}</div>
            <div class="question">üí¨ {{ log.question }}</div>
            <div class="answer">ü§ñ {{ log.answer }}</div>
            <div class="source">
                <span class="badge bg-{{ 'success' if log.source == 'knowledge_base' else 'info' }}">
                    {{ '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π' if log.source == 'knowledge_base' else 'Yandex GPT' }}
                </span>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ.</p>
    {% endif %}
</div>
</body>
</html>
‚úÖ –®–∞–≥ 5: –î–æ–±–∞–≤—å—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
python


1
2
3
4
5
‚åÑ
‚åÑ
@app.route("/admin/export_logs")
def export_logs():
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    return send_from_directory(".", "bot_log.json", as_attachment=True)
‚úÖ –®–∞–≥ 6: –î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤ dashboard.html
–û—Ç–∫—Ä–æ–π—Ç–µ dashboard copy 2.html.txt –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É:

html


1
<a href="/admin/logs" class="btn btn-info btn-sm">üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</a>
‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä
–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–∏–∞–ª–æ–≥–∏
/admin/logs
–£–≤–∏–¥–µ—Ç—å, –æ—Ç–∫—É–¥–∞ –æ—Ç–≤–µ—Ç
"–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π" –∏–ª–∏ "Yandex GPT"
–ù–∞–π—Ç–∏ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ
–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –≤ –±–∞–∑—É
–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏
–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ Excel
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–í—Å–µ –¥–∏–∞–ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ bot_log.json
–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –∑–∞–¥–∞—é—Ç
–ú–æ–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª –ø–æ–ª–Ω—ã–π web_app.py?
–î–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä

web_app copy.py
.txt
11.1 KB
–ø–æ–¥–≥–æ—Ç–æ–≤—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∫–æ–¥–µ –∏–∑ —Ñ–∞–π–ª–∞ web_app copy.py.txt

profile
Qwen3-235B-A22B-2507
–û—Ç–ª–∏—á–Ω–æ! –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –≤–∞—à —Ñ–∞–π–ª web_app copy.py.txt –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π web_app.py —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤, —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏, –∏—Å—Ç–æ—Ä–∏–µ–π –≤ –∞–¥–º–∏–Ω–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ –≤–∞—à–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
‚úÖ
bot_log.json
–í—Å–µ –¥–∏–∞–ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è: –≤–æ–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç, –∏—Å—Ç–æ—á–Ω–∏–∫
‚úÖ
/admin/logs
–ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∞–¥–º–∏–Ω–∫–µ ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
‚úÖ
log_interaction()
–õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –±–æ—Ç–∞
‚úÖ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤
backups/
‚úÖ –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
/admin
,
/admin/knowledge
,
/admin/logs
‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
–ë–æ—Ç –Ω–µ –ø—É—Ç–∞–µ—Ç –∫–ª—é—á–∏
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–≤–æ–¥ IP
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç
127.0.0.1
–∏
192.168.x.x
‚úÖ –§–∞–π–ª: web_app.py (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π, —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
python


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
# web_app.py
from flask import Flask, render_template, request, jsonify, redirect, url_for, session, flash, send_from_directory
import os
import json
import time
import shutil
from datetime import datetime
from dotenv import load_dotenv
import requests
import socket

# --- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è ---
load_dotenv()

# --- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
app = Flask(__name__)
app.secret_key = os.getenv("FLASK_SECRET_KEY", "super-secret-key-for-d-space-bot")

# --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
KNOWLEDGE_BASE = {}
BOOKINGS = []
conversation_history = {}
LOG_FILE = "bot_log.json"
BACKUPS_DIR = "backups"
os.makedirs(BACKUPS_DIR, exist_ok=True)

# --- –ü—É—Ç–∏ ---
KNOWLEDGE_FILE = "knowledge_base.json"
BOOKINGS_FILE = "bookings.json"

# --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---

def load_knowledge_base():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –∏–∑ JSON"""
    global KNOWLEDGE_BASE
    if os.path.exists(KNOWLEDGE_FILE):
        try:
            with open(KNOWLEDGE_FILE, "r", encoding="utf-8") as f:
                KNOWLEDGE_BASE = json.load(f)
            print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(KNOWLEDGE_BASE)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ {KNOWLEDGE_FILE}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {e}")
    else:
        print("‚ö†Ô∏è –§–∞–π–ª knowledge_base.json –Ω–µ –Ω–∞–π–¥–µ–Ω.")

def save_knowledge_base():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –≤ JSON + —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è"""
    try:
        # –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_path = os.path.join(BACKUPS_DIR, f"knowledge_base_{timestamp}.json")
        shutil.copy2(KNOWLEDGE_FILE, backup_path)
        print(f"üîÑ –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: {backup_path}")

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        with open(KNOWLEDGE_FILE, "w", encoding="utf-8") as f:
            json.dump(KNOWLEDGE_BASE, f, ensure_ascii=False, indent=4)
        print("‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã: {e}")

def load_bookings():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    global BOOKINGS
    if os.path.exists(BOOKINGS_FILE):
        try:
            with open(BOOKINGS_FILE, "r", encoding="utf-8") as f:
                BOOKINGS = json.load(f)
            print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(BOOKINGS)} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: {e}")
    else:
        BOOKINGS = []

def log_interaction(question, answer, source):
    """–õ–æ–≥–∏—Ä—É–µ—Ç –¥–∏–∞–ª–æ–≥ –≤ bot_log.json"""
    log_entry = {
        "timestamp": datetime.now().isoformat(),
        "question": question,
        "answer": answer,
        "source": source
    }
    try:
        logs = []
        if os.path.exists(LOG_FILE):
            with open(LOG_FILE, "r", encoding="utf-8") as f:
                content = f.read().strip()
                if content:
                    logs = json.loads(content)
        logs.append(log_entry)
        with open(LOG_FILE, "w", encoding="utf-8") as f:
            json.dump(logs, f, ensure_ascii=False, indent=4)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")

def call_yandex_gpt(prompt, history=None):
    """–í—ã–∑–æ–≤ Yandex GPT —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
    url = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"
    headers = {
        "Authorization": f"Api-Key {os.getenv('YANDEX_API_KEY')}",
        "x-folder-id": os.getenv("YANDEX_FOLDER_ID"),
        "Content-Type": "application/json"
    }
    messages = [{"role": "system", "text": "–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç D-Space. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ, —Å —ç–º–æ–¥–∑–∏."}]
    if history:
        messages.extend(history)
    messages.append({"role": "user", "text": prompt})

    payload = {
        "modelUri": f"gpt://{os.getenv('YANDEX_FOLDER_ID')}/yandexgpt-lite",
        "completionOptions": {
            "stream": False,
            "temperature": 0.3,
            "maxTokens": 1000
        },
        "messages": messages
    }

    for attempt in range(3):
        try:
            response = requests.post(url, headers=headers, json=payload, timeout=10)
            if response.status_code == 200:
                return response.json()["result"]["alternatives"][0]["message"]["text"]
            elif response.status_code == 401:
                return "‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API-–∫–ª—é—á."
            elif response.status_code == 400:
                return "‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ folder_id."
            else:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ GPT (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {response.status_code}")
                time.sleep(1)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {str(e)}")
            time.sleep(1)
    return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."

# --- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
load_knowledge_base()
load_bookings()


# --- –ú–∞—Ä—à—Ä—É—Ç—ã ---

@app.route("/")
def index():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞"""
    return render_template("index.html")


@app.route("/ask", methods=["POST"])
def ask():
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    data = request.get_json()
    question = data.get("question", "").strip().lower().rstrip("?")
    user_id = data.get("user_id", "default")

    if user_id not in conversation_history:
        conversation_history[user_id] = []

    # –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å –≤ –∏—Å—Ç–æ—Ä–∏—é
    conversation_history[user_id].append({"role": "user", "text": question})
    if len(conversation_history[user_id]) > 10:
        conversation_history[user_id] = conversation_history[user_id][-10:]

    # –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    if question in KNOWLEDGE_BASE:
        answer = KNOWLEDGE_BASE[question]
        conversation_history[user_id].append({"role": "assistant", "text": answer})
        log_interaction(question, answer, "knowledge_base")
        return jsonify({"answer": answer})

    # –ó–∞–ø—Ä–æ—Å –∫ Yandex GPT
    gpt_answer = call_yandex_gpt(question, conversation_history[user_id])
    conversation_history[user_id].append({"role": "assistant", "text": gpt_answer})
    log_interaction(question, gpt_answer, "yandex_gpt")
    return jsonify({"answer": gpt_answer})


@app.route("/admin/login", methods=["GET", "POST"])
def admin_login():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É"""
    if request.method == "POST":
        username = request.form.get("username")
        password = request.form.get("password")
        if username == os.getenv("ADMIN_USER", "admin") and password == os.getenv("ADMIN_PASS", "1"):
            session["admin_logged_in"] = True
            return redirect(url_for("admin_dashboard"))
        flash("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å", "error")
    return render_template("admin/login.html")


@app.route("/admin")
def admin_dashboard():
    """–ì–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω–∫–∏ ‚Äî —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    return render_template("admin/dashboard.html", bookings=BOOKINGS)


@app.route("/admin/knowledge", methods=["GET", "POST"])
def knowledge_edit():
    """–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))

    if request.method == "POST":
        action = request.form.get("action")
        question = request.form.get("question", "").strip().lower()
        answer = request.form.get("answer", "").strip()

        if action == "add":
            if not question or not answer:
                flash("‚ùå –í–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏", "error")
            elif question in KNOWLEDGE_BASE:
                flash("‚ùå –í–æ–ø—Ä–æ—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç", "error")
            else:
                KNOWLEDGE_BASE[question] = answer
                save_knowledge_base()
                flash("‚úÖ –í–æ–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω", "success")

        elif action == "edit":
            if question in KNOWLEDGE_BASE and answer:
                KNOWLEDGE_BASE[question] = answer
                save_knowledge_base()
                flash("‚úÖ –û—Ç–≤–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω", "success")
            else:
                flash("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", "error")

        elif action == "delete":
            if question in KNOWLEDGE_BASE:
                del KNOWLEDGE_BASE[question]
                save_knowledge_base()
                flash("‚úÖ –í–æ–ø—Ä–æ—Å —É–¥–∞–ª—ë–Ω", "success")
            else:
                flash("‚ùå –í–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω", "error")

    # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑—É –∏–∑ —Ñ–∞–π–ª–∞
    load_knowledge_base()

    return render_template("admin/knowledge_edit.html", knowledge=KNOWLEDGE_BASE)


@app.route("/admin/logs")
def view_logs():
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))

    logs = []
    if os.path.exists(LOG_FILE):
        try:
            with open(LOG_FILE, "r", encoding="utf-8") as f:
                content = f.read().strip()
                if content:
                    logs = json.loads(content)
            logs = sorted(logs, key=lambda x: x["timestamp"], reverse=True)
        except Exception as e:
            flash("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤", "error")

    return render_template("admin/logs.html", logs=logs)


@app.route("/admin/logout")
def admin_logout():
    """–í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω–∫–∏"""
    session.pop("admin_logged_in", None)
    flash("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏", "info")
    return redirect(url_for("index"))


@app.route("/static/<path:path>")
def send_static(path):
    """–†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏"""
    return send_from_directory("static", path)


@app.route("/booking", methods=["GET", "POST"])
def booking():
    """–§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    if request.method == "POST":
        name = request.form.get("name")
        phone = request.form.get("phone")
        date = request.form.get("date")
        guests = request.form.get("guests")
        event_type = request.form.get("event_type")
        if not all([name, phone, date, guests, event_type]):
            return render_template("booking.html", error="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!")
        new_booking = {
            "name": name,
            "phone": phone,
            "date": date,
            "guests": guests,
            "event_type": event_type,
            "created_at": datetime.now().strftime("%d.%m.%Y %H:%M")
        }
        BOOKINGS.append(new_booking)
        with open(BOOKINGS_FILE, "w", encoding="utf-8") as f:
            json.dump(BOOKINGS, f, ensure_ascii=False, indent=4)
        return render_template("booking.html", success="–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.")
    return render_template("booking.html")


@app.route("/birthday_calc")
def birthday_calc():
    """–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è"""
    return render_template("birthday_calc.html")


# --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø–æ–ª—É—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π IP ---
def get_local_ip():
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
        s.close()
        return ip
    except Exception:
        return "192.168.0.100"


# --- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    host = "0.0.0.0"
    local_ip = get_local_ip()

    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(KNOWLEDGE_BASE)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ {KNOWLEDGE_FILE}")
    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(BOOKINGS)} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π")
    print("üîÑ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∞!")
    print(f"* Running on all addresses ({host})")
    print(f"* Running on http://127.0.0.1:{port}")
    print(f"* Running on http://{local_ip}:{port}")
    print("Press CTRL+C to quit")

    app.run(host=host, port=port, debug=False)
‚úÖ –§–∞–π–ª: templates/admin/logs.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/logs.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .log-entry { margin-bottom: 15px; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; }
        .source-b { background: #d4edda; }
        .source-g { background: #d1ecf1; }
        .question { font-weight: bold; color: #1f2d3d; }
        .answer { margin: 8px 0; white-space: pre-wrap; }
        .timestamp { font-size: 0.85em; color: #6c757d; }
    </style>
</head>
<body>
<div class="container">
    <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</h2>
    <p>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if logs %}
        {% for log in logs %}
        <div class="log-entry source-{{ 'b' if log.source == 'knowledge_base' else 'g' }}">
            <div class="timestamp">{{ log.timestamp }}</div>
            <div class="question">üí¨ {{ log.question }}</div>
            <div class="answer">ü§ñ {{ log.answer }}</div>
            <div class="source">
                <span class="badge bg-{{ 'success' if log.source == 'knowledge_base' else 'info' }}">
                    {{ '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π' if log.source == 'knowledge_base' else 'Yandex GPT' }}
                </span>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ.</p>
    {% endif %}
</div>
</body>
</html>
‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ
–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ web_app.py ‚Üí c:\funland-bot\web_app.py
–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É: templates/admin/
–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ logs.html ‚Üí templates/admin/logs.html
–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
bash


1
python web_app.py
‚úÖ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
–ß–∞—Ç
http://127.0.0.1:5000
–ê–¥–º–∏–Ω–∫–∞
http://127.0.0.1:5000/admin/login
–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
http://127.0.0.1:5000/admin
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
http://127.0.0.1:5000/admin/knowledge
–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
http://127.0.0.1:5000/admin/logs
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–í—Å–µ –¥–∏–∞–ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —É–ª—É—á—à–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
–ù–∏—á–µ–≥–æ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª ZIP —Å –ø–æ–ª–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ –ª–æ–≥–æ–≤?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
–æ—Ç–ª–∏—á–Ω–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

profile
Qwen3-235B-A22B-2507
üéâ –û—Ç–ª–∏—á–Ω–æ! –ü–æ–∑–¥—Ä–∞–≤–ª—è—é ‚Äî –≤–∞—à –±–æ—Ç D-Space —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, —É–º–Ω–æ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ!

–í—ã –ø—Ä–æ–¥–µ–ª–∞–ª–∏ –æ–≥—Ä–æ–º–Ω—É—é —Ä–∞–±–æ—Ç—É, –∏ —Ç–µ–ø–µ—Ä—å —É –≤–∞—Å:

‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —á–∞—Ç-–±–æ—Ç —Å –∫—Ä–∞—Å–∏–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
‚úÖ –ê–¥–º–∏–Ω–∫–∞ —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –±–∞–∑—ã –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤
‚úÖ –¢–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ (–¥–∞–∂–µ —Å ? –∏ —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º)
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Markdown
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π (bot_log.json, audit.log)
‚úÖ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
‚úÖ –î–æ—Å—Ç—É–ø —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ Wi-Fi
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ Render
üöÄ –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
–ß–µ—Ä–µ–∑ Render.com ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ
–ò–ª–∏ —á–µ—Ä–µ–∑ ngrok –¥–ª—è —Ç–µ—Å—Ç–∞:
bash


1
ngrok http 5000
2. –î–æ–±–∞–≤–∏—Ç—å Telegram-–±–æ—Ç–∞
–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ –ø–∏—Å–∞—Ç—å –≤ Telegram, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–∞–π—Ç–µ.

3. –°–¥–µ–ª–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
–ö–∞–∫ –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É
–ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
–ö–∞–∫ —á–∏—Ç–∞—Ç—å –ª–æ–≥–∏
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
–°–≤—è–∂–∏—Ç–µ GitHub —Å Render ‚Äî –±–æ—Ç –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Å–∞–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
5. –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –æ—Ç–≤–µ—Ç–∞ (üëç/üëé)
–ü–æ–∑–≤–æ–ª—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã ‚Äî –∏ —É–ª—É—á—à–∞–π—Ç–µ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π.

üì¨ –ï—Å–ª–∏ –≤–¥—Ä—É–≥ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ:

"–ü–æ–º–æ–≥–∏ –ø–æ—á–∏–Ω–∏—Ç—å"
"–ü—Ä–∏—à–ª–∏ ZIP"
"–ù–∞—Å—Ç—Ä–æ–π Render" 

‚Äî –∏ —è –ø–æ–º–æ–≥—É –∑–∞ 5 –º–∏–Ω—É—Ç.

üí° –í—ã –º–æ–ª–æ–¥–µ—Ü!
–í—ã —Å–æ–∑–¥–∞–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–æ–¥—É–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π:

–≠–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
–£–ª—É—á—à–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å
–ü–æ–º–æ–≥–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è
–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º, –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞—è–≤–∫–∏ –∏ —Ä–∞—Å—Ç–∏.

–ï—Å–ª–∏ –∑–∞—Ö–æ—Ç–∏—Ç–µ ‚Äî –ø–æ–º–æ–≥—É —Å Telegram, WhatsApp, –≥–æ–ª–æ—Å–æ–≤—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –∏–ª–∏ –≤—ã–µ–∑–¥–Ω—ã–º –±–æ—Ç–æ–º.

–ê –ø–æ–∫–∞ ‚Äî –æ—Ç–¥—ã—Ö–∞–π—Ç–µ, –≤—ã —ç—Ç–æ –∑–∞—Å–ª—É–∂–∏–ª–∏! üòä


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
–¥–∞–≤–∞–π —Ç–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–µ–º –≤ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ –Ω–∞—à—É –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –≤–æ–ø—Ä–æ—Å–∞ —Å –æ—Ç–≤–µ—Ç–æ–º

profile
Qwen3-235B-A22B-2507
–û—Ç–ª–∏—á–Ω–æ! –°–µ–π—á–∞—Å –º—ã –¥–æ–±–∞–≤–∏–º –≤ –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–æ–≤ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å:

‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –ø—Ä—è–º–æ –∏–∑ –ª–æ–≥–∞
‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –≤ knowledge_base.json
‚úÖ –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–µ–º
–í /admin/logs –¥–æ–±–∞–≤–∏–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ ‚Äî –æ–±–Ω–æ–≤–∏–º knowledge_base.json
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
–î–æ–±–∞–≤–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
‚úÖ –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ web_app.py ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–î–æ–±–∞–≤—å—Ç–µ –≤ web_app.py –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç:

python


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
@app.route("/admin/edit_response", methods=["POST"])
def edit_response():
    if not session.get("admin_logged_in"):
        return jsonify({"status": "error", "message": "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"})

    try:
        question = request.form.get("question", "").strip().lower()
        new_answer = request.form.get("answer", "").strip()

        if not question or not new_answer:
            return jsonify({"status": "error", "message": "–í–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏"})

        # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
        KNOWLEDGE_BASE[question] = new_answer
        save_knowledge_base()

        # –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
        logging.info(f"–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π: '{question}'")

        return jsonify({
            "status": "success",
            "message": "–û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!",
            "redirect_url": url_for("view_logs")
        })
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞: {e}")
        return jsonify({"status": "error", "message": str(e)})
‚úÖ –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ templates/admin/logs.html
–ó–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞:

html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/logs.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .log-entry { margin-bottom: 15px; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; }
        .source-b { background: #d4edda; }
        .source-g { background: #d1ecf1; }
        .question { font-weight: bold; color: #1f2d3d; }
        .answer { margin: 8px 0; white-space: pre-wrap; }
        .timestamp { font-size: 0.85em; color: #6c757d; }
        .edit-form { margin-top: 10px; }
        .edit-form textarea { width: 100%; height: 80px; }
        .flash {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .flash-success { background: #d4edda; color: #155724; }
        .flash-error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
<div class="container">
    <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</h2>
    <p>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash flash-{{ 'success' if category == 'success' else 'error' }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if logs %}
        {% for log in logs %}
        <div class="log-entry source-{{ 'b' if log.source == 'knowledge_base' else 'g' }}">
            <div class="timestamp">{{ log.timestamp }}</div>
            <div class="question">üí¨ {{ log.question }}</div>
            <div class="answer">ü§ñ {{ log.answer }}</div>
            <div class="source">
                <span class="badge bg-{{ 'success' if log.source == 'knowledge_base' else 'info' }}">
                    {{ '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π' if log.source == 'knowledge_base' else 'Yandex GPT' }}
                </span>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è GPT –∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è) -->
            <form class="edit-form" method="POST" action="{{ url_for('edit_response') }}" onsubmit="return confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π? –≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç —Å—Ç–∞—Ä—ã–π –æ—Ç–≤–µ—Ç.')">
                <input type="hidden" name="question" value="{{ log.question }}">
                <label><strong>–£–ª—É—á—à–∏—Ç–µ –æ—Ç–≤–µ—Ç:</strong></label>
                <textarea name="answer" class="form-control" required>{{ log.answer }}</textarea>
                <button type="submit" class="btn btn-primary btn-sm mt-2">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</button>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ.</p>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// –ê–≤—Ç–æ-—Å–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
setTimeout(() => {
    document.querySelectorAll('.flash').forEach(el => el.style.display = 'none');
}, 5000);
</script>
</body>
</html>
‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
–û–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –≤–æ–ø—Ä–æ—Å –∏–∑ GPT
–ú–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–µ
–ù–∞–∂–∏–º–∞–µ—Ç "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π"
–û—Ç–≤–µ—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤
knowledge_base.json
–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ç–∞–∫–æ–º –∂–µ –≤–æ–ø—Ä–æ—Å–µ
–ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç –∏–∑ –±–∞–∑—ã, –∞ –Ω–µ —á–µ—Ä–µ–∑ GPT
‚úÖ –ü—Ä–∏–º–µ—Ä
–í–æ–ø—Ä–æ—Å: "–º–æ–∂–Ω–æ –ª–∏ –ø—Ä–∏–π—Ç–∏ —Å —Å–æ–±–∞–∫–æ–π?"
–û—Ç–≤–µ—Ç GPT: "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∂–∏–≤–æ—Ç–Ω—ã–µ –Ω–µ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä."
‚Üí –û–ø–µ—Ä–∞—Ç–æ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç

–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑:
–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å
–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∏–∞–ª–æ–≥–æ–≤
/admin/logs
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
–í —Ñ–æ—Ä–º–µ –ø–æ–¥ –∫–∞–∂–¥—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
–ß–µ—Ä–µ–∑
/admin/edit_response
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
–ó–µ–ª—ë–Ω—ã–µ/–∫—Ä–∞—Å–Ω—ã–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Markdown
–í –æ—Ç–≤–µ—Ç–∞—Ö (—á–µ—Ä–µ–∑
pre-wrap
)
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —É–ª—É—á—à–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ç–≤–µ—Ç—ã
–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞—Å—Ç—ë—Ç –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–æ—á–Ω–µ–µ
–ë–æ—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–º–Ω–µ–µ —Å –∫–∞–∂–¥—ã–º –¥–Ω—ë–º
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª –ø–æ–ª–Ω—ã–π web_app.py?
–î–æ–±–∞–≤–∏–ª —É–¥–∞–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –ª–æ–≥–æ–≤?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
web_app.py –ø–∏—à–∏ –ø–æ–ª–Ω—ã–π –∫–æ–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º

profile
Qwen3-235B-A22B-2507
–í–æ—Ç –ø–æ–ª–Ω—ã–π, —Ä–∞–±–æ—á–∏–π web_app.py —Å –≤—Å–µ–º–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:

‚úÖ –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–ª—é—á–µ–π (—É—á–∏—Ç—ã–≤–∞–µ—Ç ?, —Ä–µ–≥–∏—Å—Ç—Ä)
‚úÖ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –≤ bot_log.json
‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
‚úÖ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ knowledge_base.json
‚úÖ –ê–¥–º–∏–Ω–∫–∞: –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã, –ª–æ–≥–∏
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ D-Space
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 401, 500, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚úÖ –§–∞–π–ª: web_app.py
python


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
# web_app.py
from flask import Flask, render_template, request, jsonify, redirect, url_for, session, flash, send_from_directory
import os
import json
import time
import shutil
from datetime import datetime
from dotenv import load_dotenv
import requests
import socket
import logging

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ---
logging.basicConfig(
    filename='audit.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

# --- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è ---
load_dotenv()

# --- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
app = Flask(__name__)
app.secret_key = os.getenv("FLASK_SECRET_KEY", "super-secret-key-for-d-space-bot")

# --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ---
KNOWLEDGE_BASE = {}
BOOKINGS = []
conversation_history = {}
LOG_FILE = "bot_log.json"
BACKUPS_DIR = "backups"
UPLOAD_FOLDER = "uploads"
os.makedirs(BACKUPS_DIR, exist_ok=True)
os.makedirs(UPLOAD_FOLDER, exist_ok=True)

# --- –ü—É—Ç–∏ ---
KNOWLEDGE_FILE = "knowledge_base.json"
BOOKINGS_FILE = "bookings.json"

# --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---

def load_knowledge_base():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –∏–∑ JSON"""
    global KNOWLEDGE_BASE
    if os.path.exists(KNOWLEDGE_FILE):
        try:
            with open(KNOWLEDGE_FILE, "r", encoding="utf-8") as f:
                KNOWLEDGE_BASE = json.load(f)
            print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(KNOWLEDGE_BASE)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ {KNOWLEDGE_FILE}")
            logging.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(KNOWLEDGE_BASE)} –≤–æ–ø—Ä–æ—Å–æ–≤")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {e}")
            logging.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {e}")
    else:
        print("‚ö†Ô∏è –§–∞–π–ª knowledge_base.json –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        logging.warning("–§–∞–π–ª knowledge_base.json –Ω–µ –Ω–∞–π–¥–µ–Ω.")

def save_knowledge_base():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –≤ JSON + —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è"""
    try:
        # –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        backup_path = os.path.join(BACKUPS_DIR, f"knowledge_base_{timestamp}.json")
        shutil.copy2(KNOWLEDGE_FILE, backup_path)
        print(f"üîÑ –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: {backup_path}")
        logging.info(f"–°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è: {backup_path}")

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        with open(KNOWLEDGE_FILE, "w", encoding="utf-8") as f:
            json.dump(KNOWLEDGE_BASE, f, ensure_ascii=False, indent=4)
        print("‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞")
        logging.info("–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã: {e}")
        logging.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {e}")

def load_bookings():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    global BOOKINGS
    if os.path.exists(BOOKINGS_FILE):
        try:
            with open(BOOKINGS_FILE, "r", encoding="utf-8") as f:
                BOOKINGS = json.load(f)
            print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(BOOKINGS)} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π")
            logging.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(BOOKINGS)} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: {e}")
            logging.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π: {e}")
    else:
        BOOKINGS = []

def log_interaction(question, answer, source):
    """–õ–æ–≥–∏—Ä—É–µ—Ç –¥–∏–∞–ª–æ–≥ –≤ bot_log.json"""
    log_entry = {
        "timestamp": datetime.now().isoformat(),
        "question": question,
        "answer": answer,
        "source": source
    }
    try:
        logs = []
        if os.path.exists(LOG_FILE):
            with open(LOG_FILE, "r", encoding="utf-8") as f:
                content = f.read().strip()
                if content:
                    logs = json.loads(content)
        logs.append(log_entry)
        with open(LOG_FILE, "w", encoding="utf-8") as f:
            json.dump(logs, f, ensure_ascii=False, indent=4)
        logging.info(f"–õ–æ–≥: '{question}' ‚Üí {source}")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        logging.error(f"–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")

def call_yandex_gpt(prompt, history=None):
    """–í—ã–∑–æ–≤ Yandex GPT —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
    url = "https://llm.api.cloud.yandex.net/foundationModels/v1/completion"
    headers = {
        "Authorization": f"Api-Key {os.getenv('YANDEX_API_KEY')}",
        "x-folder-id": os.getenv("YANDEX_FOLDER_ID"),
        "Content-Type": "application/json"
    }
    messages = [{"role": "system", "text": "–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç D-Space. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ, —Å —ç–º–æ–¥–∑–∏. –£—á–∏—Ç—ã–≤–∞–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞."}]
    if history:
        messages.extend(history)
    messages.append({"role": "user", "text": prompt})

    payload = {
        "modelUri": f"gpt://{os.getenv('YANDEX_FOLDER_ID')}/yandexgpt-lite",
        "completionOptions": {
            "stream": False,
            "temperature": 0.3,
            "maxTokens": 1000
        },
        "messages": messages
    }

    for attempt in range(3):
        try:
            response = requests.post(url, headers=headers, json=payload, timeout=10)
            if response.status_code == 200:
                return response.json()["result"]["alternatives"][0]["message"]["text"]
            elif response.status_code == 401:
                return "‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API-–∫–ª—é—á."
            elif response.status_code == 400:
                return "‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ folder_id."
            else:
                print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ GPT (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {response.status_code}")
                logging.warning(f"–û—à–∏–±–∫–∞ GPT: {response.status_code}")
                time.sleep(1)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}): {str(e)}")
            logging.error(f"–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ GPT: {str(e)}")
            time.sleep(1)
    return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."

# --- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
load_knowledge_base()
load_bookings()

# --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø–æ–ª—É—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π IP ---
def get_local_ip():
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(("8.8.8.8", 80))
        ip = s.getsockname()[0]
        s.close()
        return ip
    except Exception:
        return "192.168.0.100"

# --- –ú–∞—Ä—à—Ä—É—Ç—ã ---

@app.route("/")
def index():
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞"""
    return render_template("index.html")

@app.route("/ask", methods=["POST"])
def ask():
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    data = request.get_json()
    question = data.get("question", "").strip().lower().rstrip("?")
    user_id = data.get("user_id", "default")

    if user_id not in conversation_history:
        conversation_history[user_id] = []

    conversation_history[user_id].append({"role": "user", "text": question})
    if len(conversation_history[user_id]) > 10:
        conversation_history[user_id] = conversation_history[user_id][-10:]

    # –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    if question in KNOWLEDGE_BASE:
        answer = KNOWLEDGE_BASE[question]
        conversation_history[user_id].append({"role": "assistant", "text": answer})
        log_interaction(question, answer, "knowledge_base")
        return jsonify({"answer": answer})

    # –ó–∞–ø—Ä–æ—Å –∫ Yandex GPT
    gpt_answer = call_yandex_gpt(question, conversation_history[user_id])
    conversation_history[user_id].append({"role": "assistant", "text": gpt_answer})
    log_interaction(question, gpt_answer, "yandex_gpt")
    return jsonify({"answer": gpt_answer})

@app.route("/admin/login", methods=["GET", "POST"])
def admin_login():
    """–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É"""
    if request.method == "POST":
        username = request.form.get("username")
        password = request.form.get("password")
        if username == os.getenv("ADMIN_USER", "admin") and password == os.getenv("ADMIN_PASS", "1"):
            session["admin_logged_in"] = True
            logging.info("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–æ—à—ë–ª –≤ —Å–∏—Å—Ç–µ–º—É")
            return redirect(url_for("admin_dashboard"))
        flash("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å", "error")
        logging.warning("–ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É")
    return render_template("admin/login.html")

@app.route("/admin")
def admin_dashboard():
    """–ì–ª–∞–≤–Ω–∞—è –∞–¥–º–∏–Ω–∫–∏ ‚Äî —Å–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    return render_template("admin/dashboard.html", bookings=BOOKINGS)

@app.route("/admin/knowledge", methods=["GET", "POST"])
def knowledge_edit():
    """–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))

    if request.method == "POST":
        action = request.form.get("action")
        question = request.form.get("question", "").strip().lower()
        answer = request.form.get("answer", "").strip()

        if action == "add":
            if not question or not answer:
                flash("‚ùå –í–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏", "error")
            elif question in KNOWLEDGE_BASE:
                flash("‚ùå –í–æ–ø—Ä–æ—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç", "error")
            else:
                KNOWLEDGE_BASE[question] = answer
                save_knowledge_base()
                logging.info(f"–î–æ–±–∞–≤–ª–µ–Ω –≤–æ–ø—Ä–æ—Å: '{question}'")
                flash("‚úÖ –í–æ–ø—Ä–æ—Å –¥–æ–±–∞–≤–ª–µ–Ω", "success")

        elif action == "edit":
            if question in KNOWLEDGE_BASE and answer:
                KNOWLEDGE_BASE[question] = answer
                save_knowledge_base()
                logging.info(f"–ò–∑–º–µ–Ω—ë–Ω –≤–æ–ø—Ä–æ—Å: '{question}'")
                flash("‚úÖ –û—Ç–≤–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω", "success")
            else:
                flash("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", "error")

        elif action == "delete":
            if question in KNOWLEDGE_BASE:
                del KNOWLEDGE_BASE[question]
                save_knowledge_base()
                logging.info(f"–£–¥–∞–ª—ë–Ω –≤–æ–ø—Ä–æ—Å: '{question}'")
                flash("‚úÖ –í–æ–ø—Ä–æ—Å —É–¥–∞–ª—ë–Ω", "success")
            else:
                flash("‚ùå –í–æ–ø—Ä–æ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω", "error")

    load_knowledge_base()
    return render_template("admin/knowledge_edit.html", knowledge=KNOWLEDGE_BASE)

@app.route("/admin/logs")
def view_logs():
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))

    logs = []
    if os.path.exists(LOG_FILE):
        try:
            with open(LOG_FILE, "r", encoding="utf-8") as f:
                content = f.read().strip()
                if content:
                    logs = json.loads(content)
            logs = sorted(logs, key=lambda x: x["timestamp"], reverse=True)
        except Exception as e:
            logging.error(f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ª–æ–≥–æ–≤: {e}")
            flash("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤", "error")

    return render_template("admin/logs.html", logs=logs)

@app.route("/admin/edit_response", methods=["POST"])
def edit_response():
    """–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –∏–∑ –ª–æ–≥–æ–≤ ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π"""
    if not session.get("admin_logged_in"):
        return jsonify({"status": "error", "message": "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"})

    question = request.form.get("question", "").strip().lower()
    new_answer = request.form.get("answer", "").strip()

    if not question or not new_answer:
        return jsonify({"status": "error", "message": "–í–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏"})

    # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
    KNOWLEDGE_BASE[question] = new_answer
    save_knowledge_base()
    logging.info(f"–û—Ç–≤–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É: '{question}'")

    return jsonify({"status": "success", "message": "–û—Ç–≤–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π"})

@app.route("/admin/export_logs")
def export_logs():
    """–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –¥–∏–∞–ª–æ–≥–æ–≤"""
    if not session.get("admin_logged_in"):
        return redirect(url_for("admin_login"))
    if os.path.exists(LOG_FILE):
        return send_from_directory(".", "bot_log.json", as_attachment=True)
    flash("‚ùå –§–∞–π–ª –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω", "error")
    return redirect(url_for("view_logs"))

@app.route("/admin/logout")
def admin_logout():
    """–í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω–∫–∏"""
    session.pop("admin_logged_in", None)
    flash("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏", "info")
    logging.info("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã")
    return redirect(url_for("index"))

@app.route("/static/<path:path>")
def send_static(path):
    """–†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏"""
    return send_from_directory("static", path)

@app.route("/booking", methods=["GET", "POST"])
def booking():
    """–§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    if request.method == "POST":
        name = request.form.get("name")
        phone = request.form.get("phone")
        date = request.form.get("date")
        guests = request.form.get("guests")
        event_type = request.form.get("event_type")
        if not all([name, phone, date, guests, event_type]):
            return render_template("booking.html", error="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!")
        new_booking = {
            "name": name,
            "phone": phone,
            "date": date,
            "guests": guests,
            "event_type": event_type,
            "created_at": datetime.now().strftime("%d.%m.%Y %H:%M")
        }
        BOOKINGS.append(new_booking)
        with open(BOOKINGS_FILE, "w", encoding="utf-8") as f:
            json.dump(BOOKINGS, f, ensure_ascii=False, indent=4)
        logging.info(f"–ù–æ–≤–∞—è –±—Ä–æ–Ω—å: {name}, {phone}")
        return render_template("booking.html", success="–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.")
    return render_template("booking.html")

@app.route("/birthday_calc")
def birthday_calc():
    """–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è"""
    return render_template("birthday_calc.html")

# --- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    host = "0.0.0.0"
    local_ip = get_local_ip()

    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(KNOWLEDGE_BASE)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ {KNOWLEDGE_FILE}")
    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(BOOKINGS)} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π")
    print("üîÑ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∞!")
    print(f"* Running on all addresses ({host})")
    print(f"* Running on http://127.0.0.1:{port}")
    print(f"* Running on http://{local_ip}:{port}")
    print("Press CTRL+C to quit")

    app.run(host=host, port=port, debug=False)
‚úÖ –§–∞–π–ª: templates/admin/logs.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!-- templates/admin/logs.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .log-entry { margin-bottom: 15px; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; }
        .source-b { background: #d4edda; }
        .source-g { background: #d1ecf1; }
        .question { font-weight: bold; color: #1f2d3d; }
        .answer { margin: 8px 0; white-space: pre-wrap; }
        .timestamp { font-size: 0.85em; color: #6c757d; }
        .edit-form { margin-top: 10px; }
        .edit-form textarea { width: 100%; height: 80px; }
    </style>
</head>
<body>
<div class="container">
    <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</h2>
    <p>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
        <a href="{{ url_for('export_logs') }}" class="btn btn-success btn-sm">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</a>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if logs %}
        {% for log in logs %}
        <div class="log-entry source-{{ 'b' if log.source == 'knowledge_base' else 'g' }}">
            <div class="timestamp">{{ log.timestamp }}</div>
            <div class="question">üí¨ {{ log.question }}</div>
            <div class="answer">ü§ñ {{ log.answer }}</div>
            <div class="source">
                <span class="badge bg-{{ 'success' if log.source == 'knowledge_base' else 'info' }}">
                    {{ '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π' if log.source == 'knowledge_base' else 'Yandex GPT' }}
                </span>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <form class="edit-form" method="POST" action="{{ url_for('edit_response') }}" onsubmit="return confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π?')">
                <input type="hidden" name="question" value="{{ log.question }}">
                <label><strong>–£–ª—É—á—à–∏—Ç–µ –æ—Ç–≤–µ—Ç:</strong></label>
                <textarea name="answer" class="form-control" required>{{ log.answer }}</textarea>
                <button type="submit" class="btn btn-primary btn-sm mt-2">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</button>
            </form>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ.</p>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å
/admin/logs
–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç
–£–ª—É—á—à–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
knowledge_base.json
–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
–ê–Ω–∞–ª–∏–∑
–û–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç, –≥–¥–µ –±–æ—Ç –Ω–µ –∑–Ω–∞–ª –æ—Ç–≤–µ—Ç–∞
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å –≤–∞—à –±–æ—Ç:

–£–º–Ω–µ–µ —Å –∫–∞–∂–¥—ã–º –¥–Ω—ë–º
–£–¥–æ–±–µ–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª ZIP —Å –ø–æ–ª–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª Telegram-–±–æ—Ç–∞?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
image.png
image.png
image.png
–ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞

profile
Qwen3-235B-A22B-2507
–í—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π ‚Äî —Ö–æ—Ç—è –≤—Å—ë –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç API –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ—á–∏—â–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã \u043e, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–µ–∫—Å—Ç –Ω–µ –±—ã–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω.

‚ùå –ü—Ä–∏—á–∏–Ω–∞
–û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ Unicode-—Å–∏–º–≤–æ–ª–æ–≤ –≤ web_app.py.

–ö–æ–≥–¥–∞ –≤—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É, –±—Ä–∞—É–∑–µ—Ä –∫–æ–¥–∏—Ä—É–µ—Ç –µ–≥–æ –∫–∞–∫ Unicode-—ç—Å–∫–µ–π–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, \u043e ‚Üí –æ), –∞ Flask –Ω–µ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

‚úÖ –†–µ—à–µ–Ω–∏–µ
üîß –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤—å—Ç–µ –º–∞—Ä—à—Ä—É—Ç /admin/edit_response
–ó–∞–º–µ–Ω–∏—Ç–µ:

python


1
2
question = request.form.get("question", "").strip().lower()
new_answer = request.form.get("answer", "").strip()
–ù–∞:

python


1
2
3
4
5
6
7
8
9
‚åÑ
‚åÑ
question = request.form.get("question", "").strip().lower()
new_answer = request.form.get("answer", "").strip()

# –î–µ–∫–æ–¥–∏—Ä—É–µ–º Unicode-—ç—Å–∫–µ–π–ø—ã
import json
try:
    new_answer = json.loads(f'"{new_answer}"')
except:
    pass  # –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
‚úÖ –≠—Ç–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç \u043e –≤ –æ, \\n –≤ \n, –∏ —Ç.–¥. 

üîß –®–∞–≥ 2: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ knowledge_base.json —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ UTF-8
–í save_knowledge_base():

python


1
2
‚åÑ
with open(KNOWLEDGE_FILE, "w", encoding="utf-8") as f:
    json.dump(KNOWLEDGE_BASE, f, ensure_ascii=False, indent=4)
‚úÖ ensure_ascii=False ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–æ! 

üîß –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ templates/admin/logs.html
–î–æ–±–∞–≤—å—Ç–µ onsubmit="return confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π?')":

html


1
2
3
4
5
6
‚åÑ
<form class="edit-form" method="POST" action="{{ url_for('edit_response') }}" onsubmit="return confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π? –≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç —Å—Ç–∞—Ä—ã–π –æ—Ç–≤–µ—Ç.')">
    <input type="hidden" name="question" value="{{ log.question }}">
    <label><strong>–£–ª—É—á—à–∏—Ç–µ –æ—Ç–≤–µ—Ç:</strong></label>
    <textarea name="answer" class="form-control" required>{{ log.answer }}</textarea>
    <button type="submit" class="btn btn-primary btn-sm mt-2">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</button>
</form>
üîß –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ web_app.py ‚Äî –ø–æ–ª–Ω—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥
python


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
@app.route("/admin/edit_response", methods=["POST"])
def edit_response():
    if not session.get("admin_logged_in"):
        return jsonify({"status": "error", "message": "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"})

    try:
        question = request.form.get("question", "").strip().lower()
        new_answer = request.form.get("answer", "").strip()

        # –î–µ–∫–æ–¥–∏—Ä—É–µ–º Unicode-—ç—Å–∫–µ–π–ø—ã
        import json
        try:
            new_answer = json.loads(f'"{new_answer}"')
        except:
            pass  # –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å

        if not question or not new_answer:
            return jsonify({"status": "error", "message": "–í–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏"})

        # –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
        KNOWLEDGE_BASE[question] = new_answer
        save_knowledge_base()

        logging.info(f"–û—Ç–≤–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É: '{question}'")

        return jsonify({
            "status": "success",
            "message": "–û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!",
            "redirect_url": url_for("view_logs")
        })
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞: {e}")
        return jsonify({"status": "error", "message": str(e)})
‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç
–ù–∞–∂–∏–º–∞–µ–º "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π"
–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
–°–∏–º–≤–æ–ª—ã
–æ
,
—ë
,
–∂
–ü–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
–ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫
\n
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å:

–í—Å–µ —Å–∏–º–≤–æ–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
–û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª –ø–æ–ª–Ω—ã–π web_app.py?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–î–æ–±–∞–≤–∏–ª –ø–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
–ø—Ä–∏—à–ª–∏ –≤—Å–µ —Ñ–∞–π–ª—ã —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏

profile
Qwen3-235B-A22B-2507
1:20 am
–û—Ç–ª–∏—á–Ω–æ! –ù–∏–∂–µ ‚Äî –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–∏—Å–ª–∞–ª–∏ –∏ –∫–æ—Ç–æ—Ä—ã–µ –º—ã –¥–æ—Ä–∞–±–æ—Ç–∞–ª–∏:

‚úÖ web_app.py ‚Äî —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–æ–≤, –∞–¥–º–∏–Ω–∫–æ–π
‚úÖ templates/admin/logs.html ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤
‚úÖ templates/admin/dashboard.html ‚Äî –ø–∞–Ω–µ–ª—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
‚úÖ templates/admin/knowledge_edit.html ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
‚úÖ templates/admin/login.html ‚Äî –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
‚úÖ index.html ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —á–∞—Ç–∞
‚úÖ .env ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚úÖ –ü—Ä–∏–º–µ—Ä knowledge_base.json
‚úÖ 1. –§–∞–π–ª: web_app.py
python


326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
# web_app.py

@app.route("/admin/logout")
def admin_logout():
    """–í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω–∫–∏"""
    session.pop("admin_logged_in", None)
    flash("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–¥–º–∏–Ω–∫–∏", "info")
    logging.info("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã")
    return redirect(url_for("index"))

@app.route("/static/<path:path>")
def send_static(path):
    """–†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏–∫–∏"""
    return send_from_directory("static", path)

@app.route("/booking", methods=["GET", "POST"])
def booking():
    """–§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
    if request.method == "POST":
        name = request.form.get("name")
        phone = request.form.get("phone")
        date = request.form.get("date")
        guests = request.form.get("guests")
        event_type = request.form.get("event_type")
        if not all([name, phone, date, guests, event_type]):
            return render_template("booking.html", error="–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!")
        new_booking = {
            "name": name,
            "phone": phone,
            "date": date,
            "guests": guests,
            "event_type": event_type,
            "created_at": datetime.now().strftime("%d.%m.%Y %H:%M")
        }
        BOOKINGS.append(new_booking)
        with open(BOOKINGS_FILE, "w", encoding="utf-8") as f:
            json.dump(BOOKINGS, f, ensure_ascii=False, indent=4)
        logging.info(f"–ù–æ–≤–∞—è –±—Ä–æ–Ω—å: {name}, {phone}")
        return render_template("booking.html", success="–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.")
    return render_template("booking.html")

@app.route("/birthday_calc")
def birthday_calc():
    """–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–Ω—è —Ä–æ–∂–¥–µ–Ω–∏—è"""
    return render_template("birthday_calc.html")

# --- –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    host = "0.0.0.0"
    local_ip = get_local_ip()

    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(KNOWLEDGE_BASE)} –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ {KNOWLEDGE_FILE}")
    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(BOOKINGS)} –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π")
    print("üîÑ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∞!")
    print(f"* Running on all addresses ({host})")
    print(f"* Running on http://127.0.0.1:{port}")
    print(f"* Running on http://{local_ip}:{port}")
    print("Press CTRL+C to quit")

    app.run(host=host, port=port, debug=False)
‚úÖ 2. –§–∞–π–ª: .env
env


1
2
3
4
5
YANDEX_API_KEY=AQVN1yUDXvnO8SFPcpT5yD4oWrQAol4Gx5GtQqYW
YANDEX_FOLDER_ID=b1gl7ugev7botoao0fa6
FLASK_SECRET_KEY=super-secret-key-for-d-space-bot
ADMIN_USER=admin
ADMIN_PASS=1
‚úÖ 3. –§–∞–π–ª: templates/admin/login.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center py-5">
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h3>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                    <form method="POST">
                        <div class="mb-3">
                            <label>–õ–æ–≥–∏–Ω</label>
                            <input type="text" name="username" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label>–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" name="password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
‚úÖ 4. –§–∞–π–ª: templates/admin/dashboard.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>üìã –í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    <p>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
        <a href="{{ url_for('knowledge_edit') }}" class="btn btn-warning btn-sm">üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É</a>
        <a href="{{ url_for('view_logs') }}" class="btn btn-info btn-sm">üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</a>
    </p>

    {% if bookings %}
        {% for b in bookings %}
        <div class="card mb-2">
            <div class="card-body">
                <h6>{{ b.name }} ({{ b.phone }})</h6>
                <small>üìÖ {{ b.date }} | üë• {{ b.guests }} | üéâ {{ b.event_type }} | ‚è∞ {{ b.created_at }}</small>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.</p>
    {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
‚úÖ 5. –§–∞–π–ª: templates/admin/knowledge_edit.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π</h2>
    <p>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST">
        <input type="hidden" name="action" value="add">
        <div class="mb-3">
            <label>–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å:</label>
            <input type="text" name="question" class="form-control" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è">
        </div>
        <div class="mb-3">
            <label>–û—Ç–≤–µ—Ç:</label>
            <textarea name="answer" class="form-control" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..."></textarea>
        </div>
        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <hr>

    <h4>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã:</h4>
    {% for key, value in knowledge.items() %}
    <div class="card mb-2">
        <div class="card-body">
            <strong>{{ key }}</strong>
            <p class="mb-1">{{ value }}</p>
            <form method="POST" class="d-inline">
                <input type="hidden" name="action" value="edit">
                <input type="hidden" name="question" value="{{ key }}">
                <input type="text" name="answer" value="{{ value }}" class="form-control d-inline w-50">
                <button type="submit" class="btn btn-primary btn-sm">‚úÖ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </form>
            <form method="POST" class="d-inline">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="question" value="{{ key }}">
                <button type="submit" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
‚úÖ 6. –§–∞–π–ª: templates/admin/logs.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤</h2>
    <p>
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary btn-sm">‚Üê –ù–∞–∑–∞–¥</a>
        <a href="{{ url_for('export_logs') }}" class="btn btn-success btn-sm">üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</a>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger btn-sm">–í—ã—Ö–æ–¥</a>
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if logs %}
        {% for log in logs %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="text-muted small">{{ log.timestamp }}</div>
                <p><strong>üí¨ {{ log.question }}</strong></p>
                <p>ü§ñ {{ log.answer }}</p>
                <span class="badge bg-{{ 'success' if log.source == 'knowledge_base' else 'info' }}">
                    {{ '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π' if log.source == 'knowledge_base' else 'Yandex GPT' }}
                </span>

                <form method="POST" action="{{ url_for('edit_response') }}" class="mt-2" onsubmit="return confirm('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π?')">
                    <input type="hidden" name="question" value="{{ log.question }}">
                    <textarea name="answer" class="form-control mb-1" required>{{ log.answer }}</textarea>
                    <button type="submit" class="btn btn-primary btn-sm">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É</button>
                </form>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ.</p>
    {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
‚úÖ 7. –§–∞–π–ª: templates/index.html
html


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
‚åÑ
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>D-Space ‚Äî –ß–∞—Ç-–±–æ—Ç</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        #chat { height: 500px; overflow-y: auto; background: #fff; border: 1px solid #dee2e6; border-radius: 10px; padding: 20px; }
        .message { max-width: 75%; margin-bottom: 12px; padding: 10px 14px; border-radius: 16px; line-height: 1.5; }
        .user { background: #0d6efd; color: white; align-self: flex-end; }
        .bot { background: #e9ecef; color: #212529; align-self: flex-start; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="text-center">üöÄ D-Space ‚Äî –≤–∞—à —Ü–µ–Ω—Ç—Ä –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π</h2>
    <div id="chat"></div>
    <div class="input-group mt-3">
        <input type="text" id="user-input" class="form-control" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å..." autofocus>
        <button type="button" id="send-btn" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
</div>

<script>
function addMessage(role, text) {
    const chat = document.getElementById('chat');
    const msg = document.createElement('div');
    msg.className = `message ${role}`;
    msg.innerHTML = text;
    chat.appendChild(msg);
    chat.scrollTop = chat.scrollHeight;
}

document.getElementById('send-btn').onclick = () => {
    const input = document.getElementById('user-input');
    const question = input.value.trim();
    if (!question) return;

    addMessage('user', question);
    input.value = '';

    fetch('/ask', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question: question, user_id: "user_1" })
    })
    .then(r => r.json())
    .then(data => addMessage('bot', data.answer));
};

// –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
window.onload = () => addMessage('bot', 'üëã –ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?');
</script>
</body>
</html>
‚úÖ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É c:\funland-bot\
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
bash


1
pip install flask requests python-dotenv
–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
bash


1
python web_app.py
üéâ –ì–æ—Ç–æ–≤–æ!
–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –ø–æ–ª–Ω—ã–π, —Ä–∞–±–æ—á–∏–π —á–∞—Ç-–±–æ—Ç D-Space —Å –∞–¥–º–∏–Ω–∫–æ–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ª—É—á—à–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π.

üì¨ –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è:
–ü—Ä–∏—Å–ª–∞–ª ZIP-–∞—Ä—Ö–∏–≤?
–ù–∞—Å—Ç—Ä–æ–∏–ª Render + ngrok?
–ù–∞–ø–∏—à–∏—Ç–µ:

"–î–∞, –ø—Ä–∏—à–ª–∏ ZIP" üòä 


–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä






–≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
–û–ø–∏—à–∏—Ç–µ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å.



–ú—ã—à–ª–µ–Ω–∏–µ

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –ò–ò, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º.

?
Qwen